import pandas as pd
import json
import re

# Load the JSON data into a DataFrame
with open('/workspaces/codespaces-jupyter/data/zulipchatraw.json') as f:
    data = json.load(f)
df = pd.json_normalize(data, 'messages')

# Define the words you want to extract
words = ['code', 'Gulnara', 'ChatGPT', 'because', 'write', 'thanks', 'Indrek', 'favorite', 'help', 'how', 'will', 'try', 'what', 'would', 'next']

# Count the occurrences of each word in the 'content' column and add it as a new column to the DataFrame
for word in words:
    df[word] = df['content'].str.count(word)

# Add a column for the target variable (1 for messages containing 'Gulnara', 0 otherwise)
df['target'] = df['content'].str.contains('Gulnara').astype(int)

# Remove unnecessary columns
df = df.drop(columns=['avatar_url', 'client', 'content', 'display_recipient', 'id', 'reactions', 'recipient_id', 'sender_email', 'sender_full_name', 'sender_id', 'sender_realm_str', 'stream_id', 'stream_name', 'subject', 'timestamp'])

# Save the DataFrame as a JSON data file
df.to_json('/workspaces/codespaces-jupyter/data/zulipchatprocessed.json')
